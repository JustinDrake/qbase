var assert = require('assert'),
    express = require('express'),
    gzip = require('connect-gzip');

var app = express.createServer();

app.set('view engine', 'jade');
app.use(gzip.gzip());
app.use(express.bodyParser());
app.use(express.cookieParser());
app.use(express.session({secret: 'xxx',}));

var name = 1;
app.get('/', function(req, res) {
  var sess = req.session;
  sess.name || (sess.name = name++);
  console.log(req.session);
//  res.redirect('http://google.com/');
  res.writeHead(303, { 'Location': 'http://google.com/' });
  res.end();
});

app.get('/two', function (req, res) {
  var sess = req.session;
  sess.name || (sess.name = name++);
  console.log(req.session);
  assert.equal(sess.name, 1);
  res.render('main', {layout: false});
});

app.listen(3000);
