define(["underscore","backbone","text!templates/questionTemplate.html","userModel","timeago"],function(a,b,c,d){var e=b.View.extend({initialize:function(){this.model.bind("destroy",this.destroySelf,this),this.model.bind("change:upVotes",this.refreshVotes,this),this.model.bind("change:downVotes",this.refreshVotes,this),this.render(),this.refreshVotes(),this.delegateEvents()},events:{"click .remove":"destroyModel","click .upvote":"upvote","click .downvote":"downvote","click .tags":"searchByTag"},render:function(){return this.el=$(this.template(this.model.toJSON()))},refreshVotes:function(){this.el.find(".votes").text(this.model.get("upVotes")-this.model.get("downVotes")),this.el.find(".upvote, .downvote").removeClass("upvoted downvoted");var a=this.model.get("userVote");a===-1?this.el.find(".downvote").addClass("downvoted"):a===1&&this.el.find(".upvote").addClass("upvoted")},destroyModel:function(){this.model.destroy()},destroySelf:function(){var a=this.el;a.fadeTo(200,.2,function(){a.children().slideUp(200,function(){a.remove()})})},upvote:function(){var b=d.get("_id");b?a.indexOf(this.model.get("upVoters"),b)===-1?(this.model.get("upVoters").push(b),this.model.set({userVote:1,upVotes:this.model.get("upVotes")+(a.indexOf(this.model.get("downVoters"),b)===-1?1:2),downVoters:a.without(this.model.get("downVoters"),b)}),this.model.save()):console.info("Question already upvoted!"):this.highlightLogin()},template:a.template(c),downvote:function(){var b=d.get("_id");b?a.indexOf(this.model.get("downVoters"),b)===-1?(this.model.get("downVoters").push(b),this.model.set({userVote:-1,downVotes:this.model.get("downVotes")+(a.indexOf(this.model.get("upVoters"),b)===-1?1:2),upVoters:a.without(this.model.get("upVoters"),b)}),this.model.save()):console.info("Question already downvoted!"):this.highlightLogin()},highlightLogin:function(){$("#login").children().css("color","red")},searchByTag:function(a){$("#showsearch").click(),$("#searchinput").val($(a.target).text()),$("#searchbutton").click()}});return e})